{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">Historial de ventas</h4>
<form class="row g-2 mb-3" method="get">
  <div class="col-auto">
    <label class="form-label">Método</label>
    <select class="form-select" name="method">
      <option value="all" {% if sel_method == 'all' %}selected{% endif %}>Todos</option>
      <option value="cash" {% if sel_method == 'cash' %}selected{% endif %}>Efectivo</option>
      <option value="card" {% if sel_method == 'card' %}selected{% endif %}>Tarjeta</option>
    </select>
  </div>
  <div class="col-auto">
    <label class="form-label">Mes</label>
    <input class="form-control" type="number" min="1" max="12" name="month" value="{{ sel_month|default:'' }}">
  </div>
  <div class="col-auto">
    <label class="form-label">Año</label>
    <input class="form-control" type="number" min="2000" max="2100" name="year" value="{{ sel_year|default:'' }}">
  </div>
  <div class="col-auto align-self-end">
    <button class="btn btn-outline-primary">Filtrar</button>
  </div>
</form>

<div class="d-flex justify-content-between align-items-center mb-2">
  <div><strong>Total periodo:</strong> ${{ total_sum }}</div>
  <a class="btn btn-sm btn-outline-secondary" href="?">Limpiar filtros</a>
</div>

<div class="table-responsive">
  <table class="table table-sm">
    <thead>
      <tr><th>ID</th><th>Fecha</th><th>Método</th><th class="text-end">Total</th><th class="text-end">Efectivo</th><th class="text-end">Cambio</th></tr>
    </thead>
    <tbody>
    {% for s in sales %}
      <tr>
        <td>#{{ s.id }}</td>
        <td>{{ s.created_at|date:"Y-m-d H:i" }}</td>
        <td>{{ s.get_payment_method_display }}</td>
        <td class="text-end">${{ s.total }}</td>
        <td class="text-end">{% if s.cash_given %}${{ s.cash_given }}{% else %}-{% endif %}</td>
        <td class="text-end">{% if s.change %}${{ s.change }}{% else %}-{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="6" class="text-center text-muted">Sin ventas.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
