{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <h4 class="mb-0">Historial de ventas</h4>
  <div class="d-none d-lg-block">
    <form class="row g-2" method="get">
      <div class="col-auto">
        <label class="form-label">Método</label>
        <select class="form-select" name="method">
          <option value="all" {% if sel_method == 'all' %}selected{% endif %}>Todos</option>
          <option value="cash" {% if sel_method == 'cash' %}selected{% endif %}>Efectivo</option>
          <option value="card" {% if sel_method == 'card' %}selected{% endif %}>Tarjeta</option>
        </select>
      </div>
      <div class="col-auto">
        <label class="form-label">Mes</label>
        <input class="form-control" type="number" min="1" max="12" name="month" value="{{ sel_month|default:'' }}">
      </div>
      <div class="col-auto">
        <label class="form-label">Año</label>
        <input class="form-control" type="number" min="2000" max="2100" name="year" value="{{ sel_year|default:'' }}">
      </div>
      <div class="col-auto align-self-end">
        <button class="btn btn-primary">Filtrar</button>
        <a class="btn btn-outline-secondary" href="?">Limpiar</a>
      </div>
    </form>
  </div>
  <button class="btn btn-outline-secondary d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#filters">Filtros</button>
</div>

<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div><strong>Total periodo:</strong> ${{ total_sum }}</div>
      <span class="text-muted small">Mostrando {{ sales|length }} registros</span>
    </div>
    <div class="table-responsive">
      <table class="table table-hover table-sm align-middle">
        <thead>
          <tr><th>ID</th><th>Fecha</th><th>Método</th><th class="text-end">Total</th><th class="text-end">Efectivo</th><th class="text-end">Cambio</th></tr>
        </thead>
        <tbody>
        {% for s in sales %}
          <tr>
            <td>#{{ s.id }}</td>
            <td>{{ s.created_at|date:"Y-m-d H:i" }}</td>
            <td>
              {% if s.payment_method == 'cash' %}
                <span class="badge text-bg-success">Efectivo</span>
              {% else %}
                <span class="badge text-bg-primary">Tarjeta</span>
              {% endif %}
            </td>
            <td class="text-end">${{ s.total }}</td>
            <td class="text-end">{% if s.cash_given %}${{ s.cash_given }}{% else %}-{% endif %}</td>
            <td class="text-end">{% if s.change %}${{ s.change }}{% else %}-{% endif %}</td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="text-center text-muted">Sin ventas.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Offcanvas filtros para móvil -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="filters">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Filtros</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <form method="get" class="vstack gap-2">
      <div>
        <label class="form-label">Método</label>
        <select class="form-select" name="method">
          <option value="all" {% if sel_method == 'all' %}selected{% endif %}>Todos</option>
          <option value="cash" {% if sel_method == 'cash' %}selected{% endif %}>Efectivo</option>
          <option value="card" {% if sel_method == 'card' %}selected{% endif %}>Tarjeta</option>
        </select>
      </div>
      <div>
        <label class="form-label">Mes</label>
        <input class="form-control" type="number" min="1" max="12" name="month" value="{{ sel_month|default:'' }}">
      </div>
      <div>
        <label class="form-label">Año</label>
        <input class="form-control" type="number" min="2000" max="2100" name="year" value="{{ sel_year|default:'' }}">
      </div>
      <div class="d-grid mt-2">
        <button class="btn btn-primary">Aplicar</button>
        <a class="btn btn-outline-secondary" href="?">Limpiar</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
